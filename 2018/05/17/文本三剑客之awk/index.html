<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="akw,">










<meta name="description" content="awk介绍：awk的名称来源于三个开发者的姓名：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出， Linux文本处理三剑客之一。 有多种版本：New awk（nawk），GNU awk（gawk） 现在默认linux系统下日常使用的是gawk，用命令可以查看正在应用的awk的来源（ls -l /bin/awk ） Linux文本处理三剑客：grep：文本过滤工具（">
<meta name="keywords" content="akw">
<meta property="og:type" content="article">
<meta property="og:title" content="文本三剑客之awk">
<meta property="og:url" content="http://yoursite.com/2018/05/17/文本三剑客之awk/index.html">
<meta property="og:site_name" content="吕培新的博客">
<meta property="og:description" content="awk介绍：awk的名称来源于三个开发者的姓名：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出， Linux文本处理三剑客之一。 有多种版本：New awk（nawk），GNU awk（gawk） 现在默认linux系统下日常使用的是gawk，用命令可以查看正在应用的awk的来源（ls -l /bin/awk ） Linux文本处理三剑客：grep：文本过滤工具（">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-16T07:47:13.214Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="文本三剑客之awk">
<meta name="twitter:description" content="awk介绍：awk的名称来源于三个开发者的姓名：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出， Linux文本处理三剑客之一。 有多种版本：New awk（nawk），GNU awk（gawk） 现在默认linux系统下日常使用的是gawk，用命令可以查看正在应用的awk的来源（ls -l /bin/awk ） Linux文本处理三剑客：grep：文本过滤工具（">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/17/文本三剑客之awk/">





  <title>文本三剑客之awk | 吕培新的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">吕培新的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">生活中没有弱者，只有不愿努力的人。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-computer">
          <a href="/categories/计算机基础" rel="section">
            
            计算机基础
          </a>
        </li>
      
        
        <li class="menu-item menu-item-network">
          <a href="/categories/网络技术" rel="section">
            
            网络技术
          </a>
        </li>
      
        
        <li class="menu-item menu-item-linux">
          <a href="/categories/linux" rel="section">
            
            Linux运维
          </a>
        </li>
      
        
        <li class="menu-item menu-item-shell">
          <a href="/categories/shell脚本" rel="section">
            
            Shell脚本
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sql">
          <a href="/categories/数据库" rel="section">
            
            数据库
          </a>
        </li>
      
        
        <li class="menu-item menu-item-webserver">
          <a href="/categories/Web服务器" rel="section">
            
            Web服务器
          </a>
        </li>
      
        
        <li class="menu-item menu-item-automated">
          <a href="/categories/自动化运维" rel="section">
            
            自动化运维工具
          </a>
        </li>
      
        
        <li class="menu-item menu-item-cluster">
          <a href="/categories/集群" rel="section">
            
            集群
          </a>
        </li>
      
        
        <li class="menu-item menu-item-test">
          <a href="/categories/文本三剑客" rel="section">
            
            文本三剑客
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/17/文本三剑客之awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕培新">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="吕培新的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">文本三剑客之awk</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-17T14:41:54+08:00">
                2018-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/文本三剑客/" itemprop="url" rel="index">
                    <span itemprop="name">文本三剑客</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="awk介绍："><a href="#awk介绍：" class="headerlink" title="awk介绍："></a><strong>awk介绍：</strong></h2><p><strong>awk</strong>的名称来源于三个开发者的姓名：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出，</p>
<p>Linux文本处理三剑客之一。</p>
<p>有多种版本：New awk（nawk），GNU awk（gawk）</p>
<p>现在默认linux系统下日常使用的是gawk，用命令可以查看正在应用的awk的来源（ls -l /bin/awk ）</p>
<h3 id="Linux文本处理三剑客："><a href="#Linux文本处理三剑客：" class="headerlink" title="Linux文本处理三剑客："></a>Linux文本处理三剑客：</h3><p>grep：文本过滤工具（</p>
<p>sed： 文本编辑工具</p>
<p>awk：Linux上的实现gawk，文本报告生成</p>
<p><strong>Awk</strong>编程语言用于处理文本文件。Awk在默认情况下，Awk文件的每一行都被视为一个记录。然后Awk记</p>
<p>录进一步分解成一系列的字段。Awk程序就是一系列作用在记录和字段上的”识别-执行”操作语句。</p>
<p><strong>行row</strong>：记录record</p>
<p><strong>列column</strong>：字段，域field，属性</p>
<h3 id="awk工作原理："><a href="#awk工作原理：" class="headerlink" title="awk工作原理："></a><strong>awk工作原理：</strong></h3><p><strong>awk</strong> 程序通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块，共3部分组成</p>
<p>第一步：执行BEGIN{action；…}语句块中的语句</p>
<p>第二步：从文件或标准输入读取一行，然后执行pattern{action;…}语句块，它逐行扫描文件，</p>
<p>​        从第一行到最后一行重复这个过程，直到文件全部被读取完毕。</p>
<p>第三步：当读至输入流末尾时，执行END{action;…}语句块</p>
<p><strong>BEGIN语句块: </strong>在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，比如变量初始化、打印输入表格的表头等语句通常可以写在BEGIN语句块中，</p>
<p><strong>END语句块: </strong>在awk从输入流中读取完所有的行后才被执行，比如打印所有所有行的分析结果，这里信息汇总都在END语句块中完成，它也是一个可选语句块</p>
<p><strong>pattern语句块: </strong>中的同用命令是最重要的部分，也是可选的。如果没有提供pattern语句块，则默认执行{print}，即打印每一个读取到的行，awk读取的每一行都会执行该语句块</p>
<p><strong>BEGIN语句常用于打印表头</strong></p>
<p><strong>END语句往往用来做汇总</strong></p>
<h2 id="awk基本用法："><a href="#awk基本用法：" class="headerlink" title="awk基本用法："></a><strong>awk基本用法：</strong></h2><h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a><strong>awk</strong></h3><p><strong>基本用法：</strong></p>
<p>​        awk [options] ‘program’ var=value file…</p>
<p>​         awk [options] -f programfile var=value file…</p>
<p>​         awk [options] ‘BEGIN{ action;… } pattern{ action;… } END{ action;… }’ file …</p>
<p><strong>option：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-F    指明输入时用到的字段分隔符</span><br><span class="line"></span><br><span class="line">-v    var=value: 自定义变量</span><br></pre></td></tr></table></figure>
<p><strong>基本格式：</strong>awk [options] ‘program’ var=value file…</p>
<p><strong>program：</strong>pattern{action statement}</p>
<p>其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。</p>
<p><strong>pattern和action：</strong></p>
<p>pattern部分决定动作语句何时触发及触发事件</p>
<p>如：BEGIN，END</p>
<p>action statements对数据进行处理，放在{}内指明</p>
<p>如：print，printf</p>
<p><strong>分隔符、域和记录</strong></p>
<p>awk执行时，由分隔符分隔的字段（域）标记$1,$2…$n成为标识域。$0表示所有域，即整行</p>
<p>文件的每一行成为记录（record）</p>
<p><strong>省略action,则默认执行print $0的操作</strong></p>
<h3 id="awk-pattern"><a href="#awk-pattern" class="headerlink" title="awk pattern"></a><strong>awk pattern</strong></h3><p>根据pattern条件，过滤匹配到的行，再做处理</p>
<ol>
<li><p><strong>如果未指定：空模式，匹配每一行</strong></p>
</li>
<li><p><strong>/regular expression/：仅处理能够模式匹配到的行，需要用/ /括起来</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;/^UUID/&#123;print $1&#125;&apos; /etc/fstab       取出包含UUID的行的第一个域</span><br><span class="line"></span><br><span class="line">awk &apos;！/^UUID/&#123;print $1&#125;&apos; /etc/fstab   取出不包含UUID的行的第一个域</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li><p><strong>relational expression：关系表达式，结果为”真”才会被处理</strong></p>
<p>​    真：结果为非0值，非空字符串</p>
<p>​    假：结果为空字符串或0值</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;i=1&apos; /etc/passwd            结果为非零值，显示/etc/passwd内容</span><br><span class="line"></span><br><span class="line">awk &apos;i=0&apos; /etc/passwd            结果为零值，不显示/etc/passwd内容</span><br><span class="line"></span><br><span class="line">awk &apos;i=&quot;&quot;&apos; /etc/passwd        结果为空，不显示/etc/passwd内容</span><br><span class="line"></span><br><span class="line">awk &apos;!(i=&quot;&quot;)&apos; /etc/passwd        结果不为空，显示/etc/passwd内容</span><br><span class="line"></span><br><span class="line">awk -F: &apos;$NF==&quot;/bin/bash&quot;&#123;print $1$NF&#125;&apos; /etc/passwd</span><br><span class="line">	显示/etc/passwd文件中Shell为/bin/bash行的用户名和Shell类型</span><br><span class="line"></span><br><span class="line">awk -F: &apos;$NF~/bash$/&#123;print $1$NF&#125;&apos; /etc/passwd</span><br><span class="line">	显示/etc/passwd文件中以bash结尾行的用户名和Shell类型</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>line ranges：行范围</strong></p>
<p>起始行，结尾行：/pat1/,/pat2/不支持直接给出数字格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 显示root开头的行到nobody开头的行之间的用户名</span><br><span class="line">awk -F: &apos;/^root\&gt;/,/^nobody\&gt;/&#123;print $1&#125;&apos;  /etc/passwd</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 	显示第10行到第20行，标准行号并显示用户名</span><br><span class="line">awk -F: &apos;(NR&gt;=10&amp;&amp;NR&lt;=20)&#123;print NR,$1&#125;&apos;  /etc/passwd</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>BEGIN/END模式</strong></p>
<p>BEGIN{}：仅在开始处理文件中的文本之前执行一次</p>
<p>END{}：仅在文本处理完成之后执行一次</p>
<p> <strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 在/etc/passwd文件每一行上都添加USER USERID，并在处理完文本后打印end file</span><br><span class="line">awk -F: &apos;&#123;print &quot;USER USEID\n&quot;$1&quot;:&quot;$3&#125;END&#123;print &quot;end file&quot;&#125;&apos; /etc/passwd</span><br><span class="line">awk -F: &apos;&#123;print &quot;USER USEID&quot;;print $1″:&quot;$3&#125;END&#123;print&quot;end file&quot;&#125;&apos; /etc/passwd</span><br><span class="line"># 结果为0，条件为假，不显示</span><br><span class="line"></span><br><span class="line">seq 10|awk &apos;i=0&apos;</span><br><span class="line"># 结果不为0，条件为真，显示所有数字</span><br><span class="line">seq 10|awk &apos;i=1&apos;</span><br><span class="line"></span><br><span class="line"># 显示奇数，第一行i为空，!i则为非空，打印该行，第二行i为非空，!i为空则不打印，以此类推</span><br><span class="line">seq 10|awk &apos;i=!i&apos;</span><br><span class="line"></span><br><span class="line"># 显示1,0,1,0…即上例工作原理</span><br><span class="line">seq 10 | awk &apos;&#123;i=!i;print i&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 显示偶数</span><br><span class="line">seq 10|awk &apos;!(i=!i)&apos;</span><br><span class="line"></span><br><span class="line"># 显示偶数，第一行i已赋值，所以!i为空，不显示</span><br><span class="line">seq 10 |awk -v i=1 &apos;i=!i&apos;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="awp操作符："><a href="#awp操作符：" class="headerlink" title="awp操作符："></a><strong>awp操作符：</strong></h2><h3 id="输出操作符：print、printf"><a href="#输出操作符：print、printf" class="headerlink" title="输出操作符：print、printf"></a><strong>输出操作符：print、printf</strong></h3><p><strong>print格式：</strong></p>
<p>print item1，item2，…</p>
<p><strong>要点：</strong></p>
<ol>
<li>逗号分隔符</li>
<li>输出的各item可以是字符串，也可以是数值；当前记录的字段、变量或awk的表达式</li>
<li>如省略item，相当于打印整行print $0</li>
</ol>
<p><strong>printf格式：</strong></p>
<p>格式化输出：print “FORMAT”,item1,item2,…</p>
<p>要点：</p>
<ol>
<li>必须指定FORMAT（格式）</li>
<li>不会自动换行，需要显示给出换行控制符，\n</li>
<li>FROMAT中需要分别为后面每个item指定格式符</li>
</ol>
<p><strong>格式符：与item一一对应</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%c         显示字符的ASCII码</span><br><span class="line">%d,%i      显示十进制整数</span><br><span class="line">%e,%E      显示科学计数法数值</span><br><span class="line">%f         显示为浮点数</span><br><span class="line">%g,%G      以科学计数法或浮点形式显示数值</span><br><span class="line">%s         显示字符串</span><br><span class="line">%u         无符号整数</span><br><span class="line">%%         显示%自身</span><br></pre></td></tr></table></figure>
<p><strong>修饰符：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#[.#]     第一个#控制显示的宽度；第二个#表示小数点后精度，%3.1f</span><br><span class="line">–    左对齐（默认右对齐）%-15s</span><br><span class="line">+	 显示数值的正负符号 %+d</span><br></pre></td></tr></table></figure>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 将/etc/passwd文件中所有用户名作为一个字符串输出</span><br><span class="line">	awk -F: &apos;&#123;printf &quot;%s&quot;,$1&#125;&apos; /etc/passwd</span><br><span class="line">	awk -F: &apos;&#123;printf &quot;%s\n&quot;,$1&#125;&apos; /etc/passwd</span><br><span class="line">效果等同于awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 显示用户名左对齐，UID以十进制数显示且宽度为10</span><br><span class="line">	awk -F: &apos;&#123;printf &quot;%-20s %10d\n&quot;,$1,$3&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">	awk -F: &apos;&#123;printf &quot;Username: %s\n&quot;,$1&#125;&apos; /etc/passwd</span><br><span class="line">效果等同于awk -F: &apos;&#123;print &quot;Username: &quot;$1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -F: &apos;&#123;printf &quot;Username: %s,UID:%d\n&quot;,$1,$3&#125;&apos; /etc/passwd</span><br><span class="line">显示结果如：</span><br><span class="line">	Username: basher,UID:504</span><br><span class="line"></span><br><span class="line">awk -F: &apos;&#123;printf &quot;Username: %15s,UID:%d\n&quot;,$1,$3&#125;&apos; /etc/passwd</span><br><span class="line">显示结果如：</span><br><span class="line">	Username:  basher,UID:504</span><br></pre></td></tr></table></figure>
<h3 id="awk变量："><a href="#awk变量：" class="headerlink" title="awk变量："></a><strong>awk变量：</strong></h3><p><strong>变量：内置和自定义变量</strong></p>
<p><strong>内置变量：</strong></p>
<ul>
<li>FS：输入字段分隔符，默认为空白字符</li>
<li>OFS：输出字段分隔符，默认为空白字符</li>
<li>RS：输入记录分隔符，指定输入时的换行符</li>
<li>ORS：输出记录分隔符，输出时用指定符号代替换行符</li>
<li>NF：字段数量</li>
<li>NR：记录号，相当于行号</li>
<li>FNR：同时针对多个文件时，分别计数，添加记录号</li>
<li>FILENAME：当前文件名</li>
<li>ARGC：命令行参数的个数</li>
<li>ARGV：数组，保存的是命令行所给定的各参数，参数标号默认从0开始，且第一个参数为awk命令本身</li>
</ul>
<p><strong>注：</strong>引用内置变量不需要加$</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 以：作为分隔符，显示每行的第一和第三个域，即用户名和UID</span><br><span class="line">awk -F:  &apos;&#123;print $1″:&quot;$3&#125;&apos;  /etc/passwd               等价于</span><br><span class="line">awk -v FS=&apos;:&apos; &apos;&#123;print $1FS$3&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 以：作为分隔符，取出用户名，UID，shell类型，并以：分隔</span><br><span class="line">awk -v FS=&quot;:&quot; -v OFS=&quot;:&quot; &apos;&#123;print $1,$3,$7&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">没# 有记录分隔符，文件被看做一个整体记录，取$2即为第二行</span><br><span class="line">awk -v RS=&quot; &apos;&#123;print$2&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 没有记录分隔符，文件被看做一个整体的记录，文件尾添加###</span><br><span class="line">awk -v RS=&quot; -v ORS=&apos;###&apos; &apos;&#123;print&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 显示以：为分隔符，每一个行的字段数量</span><br><span class="line">awk -F: &apos;&#123;print NF&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 打印/etc/passwd每行的倒数第二个字段</span><br><span class="line">awk -F: &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 显示/etc/fstab文件每行行号，总行号</span><br><span class="line">awk &apos;&#123;print NR&#125;&apos; /etc/fstab ; awk END&apos;&#123;print NR&#125;&apos; /etc/fstab</span><br><span class="line"></span><br><span class="line"># 对/etc/fstab和/etc/inittab文件分别计数，显示行号</span><br><span class="line">awk &apos;&#123;print FNR&#125;&apos; /etc/fstab /etc/inittab</span><br><span class="line"></span><br><span class="line"># 在/etc/fstab文件每一行显示文件名</span><br><span class="line">awk &apos;&#123;print FILENAME&#125;&apos; /etc/fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 显示每行参数的个数</span><br><span class="line">awk &apos;&#123;print ARGC&#125;&apos; /etc/fstab /etc/inittab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 显示第一个和第二个参数：awk   /etc/fstab</span><br><span class="line">awk &apos;BEGIN&#123;print ARGV[0],ARGV[1]&#125;&apos; /etc/fstab /etc/inittab</span><br></pre></td></tr></table></figure>
<p><strong>自定义变量（区分字符大小写）：</strong></p>
<ol>
<li>-v var=value</li>
<li>在program中直接定义</li>
</ol>
<p><strong>注：</strong>{}内赋值变量要用；隔开；</p>
<p>​    {}外赋值变量时，每个变量前都要加-v选项；</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 在/etc/fstab文件每一行打印hello</span><br><span class="line">awk -v test=&apos;hello&apos; &apos;&#123;print test&#125;&apos; /etc/fstab    </span><br><span class="line"></span><br><span class="line"># 打印hello</span><br><span class="line">awk -v test=&apos;hello&apos; &apos;BEGIN&#123;print test&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 打印hello，&#123;&#125;内赋值变量后加；</span><br><span class="line">awk &apos;BEGIN&#123;test=&quot;hello&quot;;print test&#125;&apos;     </span><br><span class="line"></span><br><span class="line"># 取出每行用户名，并在用户名后，打印male 18</span><br><span class="line">awk -F: &apos;&#123;age=18;sex=&quot;male&quot;;print $1,sex,age;&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取出每一行的用户名和UID并在每行前面打印awk</span><br><span class="line">cat awkscript</span><br><span class="line">	&#123;print script$1$3&#125;</span><br><span class="line">awk -F: -f awkscript  script=&quot;awk&quot;  /etc/passwd</span><br></pre></td></tr></table></figure>
<h3 id="算术操作符："><a href="#算术操作符：" class="headerlink" title="算术操作符："></a><strong>算术操作符：</strong></h3><p>x+y   加法运算</p>
<p>x-y   减法运算</p>
<p>x*y   乘法运算</p>
<p>x/y   除法运算（可精确到小数点）</p>
<p>x^y   乘方运算</p>
<p>x%y  取余运算</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">计算9/2.2的结果为4.09091</span><br><span class="line">awk &apos;BEGIN&#123;print 9/2.2&#125;&apos;</span><br><span class="line"></span><br><span class="line">计算2的10次方显示1024</span><br><span class="line">awk &apos;BEGIN&#123;print 2^10&#125;&apos;</span><br></pre></td></tr></table></figure>
<p>字符串操作符：没有符合的操作符，字符串连接</p>
<p><strong>赋值操作符：</strong></p>
<p>=，+=，-=，*=，/=，%=，^=，++，–</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;BEGIN&#123;i=0;print ++i,i &#125;&apos;</span><br><span class="line">显示：1  1</span><br><span class="line"></span><br><span class="line">awk &apos;BEGIN&#123;i=0;print i++,i &#125;&apos;</span><br><span class="line">显示：0  1</span><br><span class="line"></span><br><span class="line">awk &apos;BEGIN&#123;i=0;print i+=5,i&#125;&apos;</span><br><span class="line">显示：5  5</span><br></pre></td></tr></table></figure>
<p><strong>比较操作符：</strong></p>
<p>==，!=，&gt;，&gt;=，&lt;，&lt;=</p>
<p><strong>模式匹配符：</strong></p>
<p>~ ：左边是否和右边匹配包含!~：是否不匹配</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 取/etc/passwd文件中包含root的行中以：为分隔符的第一个域</span><br><span class="line">awk -F: &apos;$0 ~ /root/&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取/etc/passwd文件中以root开头的行</span><br><span class="line">awk &apos;$0 ~ &quot;^root&quot;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">取/etc/passwd文件中不包含root的行</span><br><span class="line">awk &apos;$0 !~ &quot;root&quot;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取/etc/passwd文件中UID=0的行</span><br><span class="line">awk -F: &apos;$3==0&apos; /etc/passwd</span><br></pre></td></tr></table></figure>
<h3 id="逻辑操作符："><a href="#逻辑操作符：" class="headerlink" title="逻辑操作符："></a><strong>逻辑操作符：</strong></h3><p>&amp;&amp;   与</p>
<p>||     或</p>
<p>！    非</p>
<p>注意：这里的&amp;&amp;和||不是shell中的短路与和短路或，而是类似于[test]判断中的-a和-e</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 取出/etc/passwd文件中UID大于0且小于1000的用户名</span><br><span class="line">awk -F: &apos;$3&gt;=0 &amp;&amp; $3&lt;=1000&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取出/etc/passwd文件中UID等于0或小于1000的用户名</span><br><span class="line">awk -F: &apos;$3==0 || $3&lt;=1000&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取出/etc/passwd文件中UID不等于0的用户名</span><br><span class="line">awk -F: &apos;!($3==0)&#123;print $1&#125;&apos; /etc/passwd</span><br></pre></td></tr></table></figure>
<p><strong>函数调用：</strong>function_name（argu1，argu2…）</p>
<h3 id="条件表达式（三目表达式）："><a href="#条件表达式（三目表达式）：" class="headerlink" title="条件表达式（三目表达式）："></a><strong>条件表达式（三目表达式）：</strong></h3><p>格式：</p>
<p><strong>条件判断式？</strong>if-true-expression:if-false-expression</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 判断/etc/passwd文件中如果UID大于1000，在用户名后标注普通用户，如果UID小于1000，则标注root或系统用户</span><br><span class="line">awk -F:  &apos;&#123;$3&gt;=1000?usertype=&quot;Common User&quot;:usertype=&quot;Sysadmin or SysUser&quot;;printf</span><br><span class="line">&quot;%15s:%-s\n&quot;,$1,usertype&#125;&apos;  /etc/passwd</span><br><span class="line"></span><br><span class="line">显示：rpcuser:Sysadmin or SysUser</span><br><span class="line">	 nfsnobody:Common User</span><br></pre></td></tr></table></figure>
<h2 id="awk循环判断："><a href="#awk循环判断：" class="headerlink" title="awk循环判断："></a><strong>awk循环判断：</strong></h2><h3 id="if-else语句"><a href="#if-else语句" class="headerlink" title="if-else语句"></a><strong>if-else语句</strong></h3><p>语法：if（condition）{statement;…}[else statement]</p>
<p>​      if（condition1）{statement1;…}else if（condition2）{statement2;…}else{statement3}</p>
<p>使用场景：对awk取得的整行或某个字段做条件判断</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 打印UID大于等于1000的用户名和UID</span><br><span class="line">awk -F: &apos;&#123;if($3&gt;=1000)print$1,$3&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 打印shell类型为/bin/bash的用户名和UID</span><br><span class="line">awk -F: &apos;&#123;if($NF==&quot;/bin/bash&quot;)print$1,$3&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line"># 显示/etc/fstab文件中字段大于5的行</span><br><span class="line">awk &apos;&#123;if(NF&gt;5)print$0&#125;&apos; /etc/fstab</span><br><span class="line"></span><br><span class="line"># 取出UID大于等于1000用户名，并在前面加Common user：其他用户名前加System or root：</span><br><span class="line">awk -F: &apos;&#123;if($3&gt;=1000)&#123;printf &quot;Common user: %s\n&quot;,$1&#125;else&#123;printf &quot;System or root: %s\n&quot;,$1&#125;&#125;&apos;  /etc/passwd</span><br><span class="line"></span><br><span class="line"># 等同于上例，在只有两种条件时，可用此格式替换</span><br><span class="line">awk -F: &apos;&#123;if($3&gt;=1000)printf &quot;Common user: %s\n&quot;,$1;else printf &quot;System or root: %s\n&quot;,$1&#125;&apos;  /etc/passwd</span><br><span class="line"></span><br><span class="line"># 取出磁盘利用率大于80的磁盘名称和磁盘利用率</span><br><span class="line">df -h|awk -F% &apos;/^\/dev/&#123;print $1&#125;&apos;|awk &apos;$NF&gt;80&#123;print $1,$NF&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 如果test打印90显示very good，大于60小于90显示good，小于60显示no pass</span><br><span class="line">awk &apos;BEGIN&#123;test=100;if(test&gt;90)&#123;print &quot;very good&quot;&#125;else if(test&gt;60)&#123; print &quot;good&quot;&#125;else&#123;print &quot;no pass&quot;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3 id="while循环语句"><a href="#while循环语句" class="headerlink" title="while循环语句"></a>while循环语句</h3><p>语法：while（condition）{statement}</p>
<p>条件为”真”，进入循环；条件为”假”，退出循环</p>
<p>使用场景：</p>
<p>a）对一行内的多个字段之一类似处理时使用</p>
<p>b）对数组中的各元素逐一处理时使用</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 取出grub2文件中空白开头跟linux16的行，并显示每个字段和每个字段的字符数</span><br><span class="line">awk &apos;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;print $i,length($i); i++&#125;&#125;&apos; /etc/grub2.cfg</span><br><span class="line"></span><br><span class="line"># 取出grub2文件中空白开头跟linux16的行，并显示字符数大于10个的字段和对应字段的字符数</span><br><span class="line">awk &apos;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF)&#123;if(length($i)&gt;=10) &#123;print $i,length($i)&#125;; i++&#125;&#125;&apos; /etc/grub2.cfg</span><br></pre></td></tr></table></figure>
<h3 id="do-whlie循环语句"><a href="#do-whlie循环语句" class="headerlink" title="do-whlie循环语句"></a><strong>do-whlie循环语句</strong></h3><p>语法：do{statement;…}while（condition）</p>
<p>意义：无论真假，至少执行一次循环体</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">计算1到100的数字之和：</span><br><span class="line">awk &apos;BEGIN&#123;i=1;sum=0;do&#123;sum+=i;i++;&#125;while(i&lt;=100);print sum&#125;&apos;</span><br><span class="line">对比</span><br><span class="line">awk &apos;BEGIN&#123;i=1;sum=0;while(i&lt;=100)&#123;sum+=i;i++&#125;;print sum&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3 id="for循环语句"><a href="#for循环语句" class="headerlink" title="for循环语句"></a><strong>for循环语句</strong></h3><p><strong>语法：</strong>for(expr1;expr2;expr3) {statement;…}</p>
<p><strong>常见用法：</strong></p>
<p>for(variable assignment;condition;iteration process)</p>
<p>{for-body}</p>
<p><strong>特殊用法：</strong>能够遍历数组中的元素</p>
<p><strong>语法：</strong>for(var in array) {for-body}</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">计算1到100数字之和</span><br><span class="line">awk &quot;BEGIN&#123;for(i=0;i&lt;=100;i++)sum+=i;print sum&#125;&quot;</span><br><span class="line"></span><br><span class="line">与shell语言for循环第二种风格很类似：</span><br><span class="line">for ((i=1,sum=0;i&lt;=100;i++));do let sum+=i;done;echo $sum</span><br></pre></td></tr></table></figure>
<h3 id="break和continue"><a href="#break和continue" class="headerlink" title="break和continue"></a><strong>break和continue</strong></h3><p>用于循环体中</p>
<p>break：提前结束本轮循环</p>
<p>continue：提前结束本轮循环，而直接进入下一轮判断；</p>
<p>break[N]：提前结束第N层循环，最内层为第一层</p>
<p>continue[N]：提前结束第N层的本轮循环，而直接进入下一轮判断；最内层为第1层</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 计算1到100奇数之和，数字为偶数时跳过，奇数时相加</span><br><span class="line">awk &apos;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i%2==0)continue;sum+=i&#125;print sum&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 数字加到66时，break退出循环，结果为1到66的数字之和</span><br><span class="line">awk &apos;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i==66)break;sum+=i&#125;print sum&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3 id="next语句"><a href="#next语句" class="headerlink" title="next语句"></a><strong>next语句</strong></h3><p>提前结束对本行处理而直接进入下一行处理（awk自身循环）</p>
<p>awk -F: ‘{if($3%2!=0) next; print $1,$3}’ /etc/passwd</p>
<h3 id="awk数组："><a href="#awk数组：" class="headerlink" title="awk数组："></a><strong>awk数组：</strong></h3><p><strong>关联数组：</strong>array[#]</p>
<p><strong>下标：</strong></p>
<p>​    a. 可使用任意字符串；字符串要使用双引号括起来</p>
<p>​    b. 如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初始化为”空串”</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">weekdays[&quot;mon&quot;]=&quot;Monday&quot;</span><br><span class="line"></span><br><span class="line">awk &apos;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;print weekdays[&quot;mon&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line">awk !arr[$0]++  dupfile     取出文件内容重复行</span><br></pre></td></tr></table></figure>
<h3 id="遍历数组："><a href="#遍历数组：" class="headerlink" title="遍历数组："></a><strong>遍历数组：</strong></h3><p>使用for循环可遍历数组中的每个元素</p>
<p>格式：for(var in array) {for-body}</p>
<p>注意：var会遍历array的每个索引</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 显示weekdays[]数组中的每个元素</span><br><span class="line">awk &apos;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;for(i in weekdays) &#123;print weekdays[i]&#125;&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 显示网络连接每种状态的数量</span><br><span class="line">netstat -tan|awk &apos;/^tcp/&#123;state[$NF]++&#125;END&#123;for(i in state)&#123;print i,state[i]&#125;&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 统计网络访问ip和访问次数</span><br><span class="line">awk &apos;&#123;ip[$1]++&#125;END&#123;for(i in ip) &#123;print i,ip[i]&#125;&#125;&apos; /var/log/httpd/access_log</span><br></pre></td></tr></table></figure>
<h3 id="awk函数："><a href="#awk函数：" class="headerlink" title="awk函数："></a><strong>awk函数：</strong></h3><p><strong>系统内置函数：</strong></p>
<p>数组处理：</p>
<ul>
<li><p>rand（）：返回0和1之间一个随机数，只有和srand（）函数配合才生效</p>
<p><strong>示例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 返回0和1之间一个随机数</span><br><span class="line">awk &apos;BEGIN&#123;srand();print rand()&#125;&apos;</span><br><span class="line"></span><br><span class="line"># 返回10个0到100之间的随机数</span><br><span class="line">awk &apos;BEGIN&#123;srand();for(i=1;i&lt;=10;i++)print rand()*100&#125;&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>字符串处理：</strong></p>
<ul>
<li><p>length([s])：返回指定字符串的长度</p>
</li>
<li><p>sub(r,s,[t])：对t字符串进行搜索r表示的模式匹配的内容，并将第一个匹配的内容替换为s</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">示例：替换字符第一个出现的&quot;：&quot;为&quot;-&quot;；</span><br><span class="line">echo &quot;2008:08:08 08:08:08&quot; | awk &apos;sub(/:/,&quot;-&quot;,$1)&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>gsub(r,s,[t])：对t字符串进行搜索r表示的模式匹配的内容，并全部替换为s所表示的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">示例：全局替换字符第一个出现的&quot;：&quot;为&quot;-&quot;；</span><br><span class="line">echo &quot;2008:08:08 08:08:08&quot; | awk &apos;gsub(/:/,&quot;-&quot;,$0)&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>split(s,array,[r])：以r为分隔符，切割字符串s，并将切割后的结果保存至array所表示的数组中，</p>
<p>第一个索引值为1,第二个索引值为2,…</p>
</li>
</ul>
<p><strong>自定义函数：</strong></p>
<p><strong>格式：</strong></p>
<p>function name ( parameter, parameter, … ) {</p>
<p>​         statements</p>
<p>​         return expression</p>
<p>}</p>
<p><strong>示例：</strong> 编写一个awk函数，比较两个数字的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat fun.awk</span><br><span class="line">    function max(v1,v2) &#123;</span><br><span class="line">    v1&gt;v2?var=v1:var=v2</span><br><span class="line">    return var</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BEGIN&#123;a=3;b=2;print max(a,b)&#125;</span><br><span class="line"># 文件调用函数</span><br><span class="line">awk –f fun.awk</span><br></pre></td></tr></table></figure>
<h3 id="awk中调用shell命令："><a href="#awk中调用shell命令：" class="headerlink" title="awk中调用shell命令："></a><strong>awk中调用shell命令：</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk BEGIN&apos;&#123;system(&quot;hostname&quot;) &#125;&apos;</span><br><span class="line"></span><br><span class="line">awk &apos;BEGIN&#123;score=100; system(&quot;echo your score is &quot; score) &#125;&apos;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/akw/" rel="tag"># akw</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/15/SELinux简介/" rel="next" title="SELinux简介">
                <i class="fa fa-chevron-left"></i> SELinux简介
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/18/Linux网络安全技术/" rel="prev" title="Linux网络安全技术">
                Linux网络安全技术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">吕培新</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#awk介绍："><span class="nav-number">1.</span> <span class="nav-text">awk介绍：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux文本处理三剑客："><span class="nav-number">1.1.</span> <span class="nav-text">Linux文本处理三剑客：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk工作原理："><span class="nav-number">1.2.</span> <span class="nav-text">awk工作原理：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk基本用法："><span class="nav-number">2.</span> <span class="nav-text">awk基本用法：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#awk"><span class="nav-number">2.1.</span> <span class="nav-text">awk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk-pattern"><span class="nav-number">2.2.</span> <span class="nav-text">awk pattern</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awp操作符："><span class="nav-number">3.</span> <span class="nav-text">awp操作符：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#输出操作符：print、printf"><span class="nav-number">3.1.</span> <span class="nav-text">输出操作符：print、printf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk变量："><span class="nav-number">3.2.</span> <span class="nav-text">awk变量：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#算术操作符："><span class="nav-number">3.3.</span> <span class="nav-text">算术操作符：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑操作符："><span class="nav-number">3.4.</span> <span class="nav-text">逻辑操作符：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件表达式（三目表达式）："><span class="nav-number">3.5.</span> <span class="nav-text">条件表达式（三目表达式）：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk循环判断："><span class="nav-number">4.</span> <span class="nav-text">awk循环判断：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if-else语句"><span class="nav-number">4.1.</span> <span class="nav-text">if-else语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while循环语句"><span class="nav-number">4.2.</span> <span class="nav-text">while循环语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#do-whlie循环语句"><span class="nav-number">4.3.</span> <span class="nav-text">do-whlie循环语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for循环语句"><span class="nav-number">4.4.</span> <span class="nav-text">for循环语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#break和continue"><span class="nav-number">4.5.</span> <span class="nav-text">break和continue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#next语句"><span class="nav-number">4.6.</span> <span class="nav-text">next语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk数组："><span class="nav-number">4.7.</span> <span class="nav-text">awk数组：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遍历数组："><span class="nav-number">4.8.</span> <span class="nav-text">遍历数组：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk函数："><span class="nav-number">4.9.</span> <span class="nav-text">awk函数：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk中调用shell命令："><span class="nav-number">4.10.</span> <span class="nav-text">awk中调用shell命令：</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吕培新</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
